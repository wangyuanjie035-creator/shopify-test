<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vercel API æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 6px;
    }
    
    .section h2 {
      color: #555;
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .input-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      color: #666;
      font-weight: 500;
    }
    
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    
    button {
      background: #0070f3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    button:hover {
      background: #0051cc;
    }
    
    button.secondary {
      background: #666;
    }
    
    button.secondary:hover {
      background: #555;
    }
    
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .result pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 12px;
    }
    
    .success {
      color: #28a745;
    }
    
    .error {
      color: #dc3545;
    }
    
    .file-list {
      list-style: none;
    }
    
    .file-list li {
      padding: 8px;
      margin: 5px 0;
      background: white;
      border-left: 3px solid #0070f3;
      border-radius: 3px;
    }
    
    .file-list li a {
      color: #0070f3;
      text-decoration: none;
    }
    
    .file-list li a:hover {
      text-decoration: underline;
    }
    
    .status {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
    }
    
    .status.ok {
      background: #d4edda;
      color: #155724;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ Vercel API æµ‹è¯•å·¥å…·</h1>
    
    <div class="section">
      <h2>1. é…ç½®APIåŸºç¡€URL</h2>
      <div class="input-group">
        <label>API Base URL:</label>
        <input type="text" id="apiBase" value="https://shopify-v587.vercel.app/api" placeholder="https://your-domain.vercel.app/api">
      </div>
      <button onclick="updateApiBase()">æ›´æ–°URL</button>
    </div>
    
    <div class="section">
      <h2>2. åˆ—å‡ºæ‰€æœ‰APIæ–‡ä»¶</h2>
      <button onclick="listFiles()">è·å–æ–‡ä»¶åˆ—è¡¨</button>
      <div id="fileListResult" class="result" style="display:none;"></div>
    </div>
    
    <div class="section">
      <h2>3. æµ‹è¯•CORSé…ç½®</h2>
      <div class="input-group">
        <label>æµ‹è¯•ç«¯ç‚¹:</label>
        <select id="testEndpoint">
          <option value="test-cors">test-cors</option>
          <option value="store-file-real">store-file-real</option>
          <option value="submit-quote-real">submit-quote-real</option>
          <option value="get-draft-orders">get-draft-orders</option>
        </select>
      </div>
      <button onclick="testCors()">æµ‹è¯•OPTIONSè¯·æ±‚</button>
      <button onclick="testGet()" class="secondary">æµ‹è¯•GETè¯·æ±‚</button>
      <div id="corsResult" class="result" style="display:none;"></div>
    </div>
    
    <div class="section">
      <h2>4. æ£€æŸ¥ç¯å¢ƒå˜é‡</h2>
      <button onclick="checkEnv()">æ£€æŸ¥ç¯å¢ƒå˜é‡</button>
      <div id="envResult" class="result" style="display:none;"></div>
    </div>
  </div>
  
  <script>
    let apiBase = 'https://shopify-v587.vercel.app/api';
    
    function updateApiBase() {
      apiBase = document.getElementById('apiBase').value.replace(/\/$/, '');
      if (!apiBase.endsWith('/api')) {
        apiBase = apiBase + '/api';
      }
      alert('API Base URLå·²æ›´æ–°ä¸º: ' + apiBase);
    }
    
    async function listFiles() {
      const resultDiv = document.getElementById('fileListResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<pre>æ­£åœ¨è·å–æ–‡ä»¶åˆ—è¡¨...</pre>';
      
      try {
        const response = await fetch(`${apiBase}/list-files`);
        const data = await response.json();
        
        if (data.success) {
          let html = '<h3>âœ… APIæ–‡ä»¶åˆ—è¡¨</h3>';
          html += '<p><strong>Base URL:</strong> ' + data.baseUrl + '</p>';
          html += '<p><strong>æ—¶é—´:</strong> ' + new Date(data.timestamp).toLocaleString() + '</p>';
          
          html += '<h4>ç¯å¢ƒå˜é‡çŠ¶æ€:</h4>';
          html += '<ul>';
          html += '<li>SHOP: ' + (data.environment.hasShop ? '<span class="status ok">âœ“ å·²è®¾ç½®</span>' : '<span class="status error">âœ— æœªè®¾ç½®</span>') + '</li>';
          html += '<li>ADMIN_TOKEN: ' + (data.environment.hasToken ? '<span class="status ok">âœ“ å·²è®¾ç½®</span>' : '<span class="status error">âœ— æœªè®¾ç½®</span>') + '</li>';
          html += '<li>NODE_ENV: ' + data.environment.nodeEnv + '</li>';
          html += '</ul>';
          
          html += '<h4>æ–‡ä»¶åˆ—è¡¨:</h4><ul class="file-list">';
          data.files.forEach(file => {
            html += `<li><a href="${file.testUrl}" target="_blank">${file.name}</a> - <code>${file.path}</code></li>`;
          });
          html += '</ul>';
          
          resultDiv.innerHTML = html;
        } else {
          resultDiv.innerHTML = '<pre class="error">è·å–å¤±è´¥: ' + JSON.stringify(data, null, 2) + '</pre>';
        }
      } catch (error) {
        resultDiv.innerHTML = '<pre class="error">é”™è¯¯: ' + error.message + '</pre>';
      }
    }
    
    async function testCors() {
      const endpoint = document.getElementById('testEndpoint').value;
      const resultDiv = document.getElementById('corsResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<pre>æ­£åœ¨æµ‹è¯•OPTIONSè¯·æ±‚...</pre>';
      
      try {
        const response = await fetch(`${apiBase}/${endpoint}`, {
          method: 'OPTIONS',
          headers: {
            'Origin': window.location.origin,
            'Access-Control-Request-Method': 'POST',
            'Access-Control-Request-Headers': 'Content-Type'
          }
        });
        
        const headers = {};
        response.headers.forEach((value, key) => {
          headers[key] = value;
        });
        
        let html = '<h3>OPTIONSè¯·æ±‚ç»“æœ</h3>';
        html += '<p><strong>çŠ¶æ€ç :</strong> ' + response.status + '</p>';
        html += '<p><strong>çŠ¶æ€æ–‡æœ¬:</strong> ' + response.statusText + '</p>';
        
        html += '<h4>å“åº”å¤´:</h4><pre>';
        html += JSON.stringify(headers, null, 2);
        html += '</pre>';
        
        if (headers['access-control-allow-origin']) {
          html += '<p class="success">âœ… CORSé…ç½®æ­£å¸¸ï¼</p>';
        } else {
          html += '<p class="error">âŒ ç¼ºå°‘CORSå¤´ï¼</p>';
        }
        
        resultDiv.innerHTML = html;
      } catch (error) {
        resultDiv.innerHTML = '<pre class="error">é”™è¯¯: ' + error.message + '</pre>';
      }
    }
    
    async function testGet() {
      const endpoint = document.getElementById('testEndpoint').value;
      const resultDiv = document.getElementById('corsResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<pre>æ­£åœ¨æµ‹è¯•GETè¯·æ±‚...</pre>';
      
      try {
        const response = await fetch(`${apiBase}/${endpoint}`);
        const data = await response.json();
        
        resultDiv.innerHTML = '<h3>GETè¯·æ±‚ç»“æœ</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
      } catch (error) {
        resultDiv.innerHTML = '<pre class="error">é”™è¯¯: ' + error.message + '</pre>';
      }
    }
    
    async function checkEnv() {
      const resultDiv = document.getElementById('envResult');
      resultDiv.style.display = 'block';
      resultDiv.innerHTML = '<pre>æ­£åœ¨æ£€æŸ¥ç¯å¢ƒå˜é‡...</pre>';
      
      try {
        const response = await fetch(`${apiBase}/list-files`);
        const data = await response.json();
        
        if (data.environment) {
          let html = '<h3>ç¯å¢ƒå˜é‡çŠ¶æ€</h3>';
          html += '<ul>';
          html += '<li><strong>SHOP/SHOPIFY_STORE_DOMAIN:</strong> ' + 
                  (data.environment.hasShop ? '<span class="status ok">âœ“ å·²è®¾ç½®</span>' : '<span class="status error">âœ— æœªè®¾ç½®</span>') + '</li>';
          html += '<li><strong>ADMIN_TOKEN/SHOPIFY_ACCESS_TOKEN:</strong> ' + 
                  (data.environment.hasToken ? '<span class="status ok">âœ“ å·²è®¾ç½®</span>' : '<span class="status error">âœ— æœªè®¾ç½®</span>') + '</li>';
          html += '<li><strong>NODE_ENV:</strong> ' + data.environment.nodeEnv + '</li>';
          html += '</ul>';
          
          if (!data.environment.hasShop || !data.environment.hasToken) {
            html += '<p class="error">âš ï¸ è¯·åœ¨Vercel Dashboardä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼</p>';
          }
          
          resultDiv.innerHTML = html;
        }
      } catch (error) {
        resultDiv.innerHTML = '<pre class="error">é”™è¯¯: ' + error.message + '</pre>';
      }
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ–‡ä»¶åˆ—è¡¨
    window.onload = function() {
      listFiles();
    };
  </script>
</body>
</html>
