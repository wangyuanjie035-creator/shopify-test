# 3Dæ¨¡å‹å®šåˆ¶æŠ¥ä»·ç³»ç»Ÿ - å·¥ä½œæµç¨‹è¯¦è§£

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [å®Œæ•´å·¥ä½œæµç¨‹](#å®Œæ•´å·¥ä½œæµç¨‹)
3. [æ•°æ®æµå‘å›¾](#æ•°æ®æµå‘å›¾)
4. [APIè°ƒç”¨æ—¶åº](#apiè°ƒç”¨æ—¶åº)
5. [æ•°æ®ç»“æ„è¯´æ˜](#æ•°æ®ç»“æ„è¯´æ˜)

---

## ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäº Shopify çš„ 3D æ¨¡å‹å®šåˆ¶åŠ å·¥æŠ¥ä»·ç³»ç»Ÿï¼Œå…è®¸å®¢æˆ·ä¸Šä¼  3D æ¨¡å‹æ–‡ä»¶ï¼ˆå¦‚ STEPã€STL ç­‰ï¼‰ï¼Œé…ç½®åŠ å·¥å‚æ•°ï¼Œæäº¤è¯¢ä»·è¯·æ±‚ï¼Œç„¶åç”±å®¢æœäººå‘˜å®¡æ ¸å¹¶æä¾›æŠ¥ä»·ã€‚

### æŠ€æœ¯æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯    â”‚ â—„â”€â”€â”€â”€â–º â”‚  Vercel API  â”‚ â—„â”€â”€â”€â”€â–º â”‚   Shopify   â”‚
â”‚  (æµè§ˆå™¨)   â”‚         â”‚  (åç«¯æœåŠ¡)  â”‚         â”‚  (æ•°æ®å­˜å‚¨) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **å‰ç«¯**: Shopify Liquid æ¨¡æ¿ + JavaScript
- **åç«¯**: Vercel Serverless Functions (Node.js)
- **æ•°æ®å­˜å‚¨**: Shopify Metaobjects (è‡ªå®šä¹‰æ•°æ®ç±»å‹)
- **æ–‡ä»¶å­˜å‚¨**: Shopify Files API
- **APIé€šä¿¡**: Shopify GraphQL Admin API

---

## å®Œæ•´å·¥ä½œæµç¨‹

### é˜¶æ®µ 1: å®¢æˆ·ä¸Šä¼ æ–‡ä»¶ ğŸ“¤

```
å®¢æˆ·æ“ä½œæµç¨‹ï¼š
1. è®¿é—®äº§å“é¡µé¢ (ä½¿ç”¨ model-uploader section)
2. ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–æ‹–æ‹½æ–‡ä»¶
3. é€‰æ‹© 3D æ¨¡å‹æ–‡ä»¶ (STEP, STL, OBJ ç­‰)
4. é…ç½®åŠ å·¥å‚æ•°ï¼š
   - ææ–™ (PLA, ABS, é‡‘å±ç­‰)
   - ç²¾åº¦ç­‰çº§ (æ ‡å‡†, é«˜ç²¾åº¦, è¶…é«˜ç²¾åº¦)
   - å…¬å·®æ ‡å‡† (GB/T 1804, ISO 2768)
   - è¡¨é¢ç²—ç³™åº¦ (Ra3.2, Ra1.6 ç­‰)
   - æ˜¯å¦æœ‰èºçº¹
   - æ˜¯å¦æœ‰è£…é…æ ‡è®°
   - ç¼©æ”¾æ¯”ä¾‹
   - æ•°é‡
   - å¤‡æ³¨
5. ç‚¹å‡»"æ·»åŠ åˆ°è´­ç‰©è½¦"
6. åœ¨è´­ç‰©è½¦é¡µé¢ç‚¹å‡»"ç«‹å³ä¸‹å•"
```

**æŠ€æœ¯å®ç°**:
- æ–‡ä»¶: `assets/model-uploader.js`
- æ–‡ä»¶è¯»å–ä¸º Base64 ç¼–ç 
- è°ƒç”¨ `/api/upload-file` ä¸Šä¼ æ–‡ä»¶
- è°ƒç”¨ `/api/quotes` åˆ›å»ºæŠ¥ä»·è®°å½•
- æ–‡ä»¶å’Œå‚æ•°ä¸€èµ·ä¿å­˜åˆ° Shopify

### é˜¶æ®µ 2: æ–‡ä»¶å­˜å‚¨ ğŸ’¾

```
æ–‡ä»¶ä¸Šä¼ æµç¨‹ï¼š
1. å‰ç«¯å‘é€ Base64 ç¼–ç çš„æ–‡ä»¶åˆ° /api/upload-file
2. åç«¯å‘ Shopify ç”³è¯·ä¸´æ—¶ä¸Šä¼ åœ°å€ (Staged Upload)
3. åç«¯å°†æ–‡ä»¶ä¸Šä¼ åˆ°ä¸´æ—¶åœ°å€
4. Shopify è‡ªåŠ¨å°†æ–‡ä»¶ç§»åˆ°æ°¸ä¹…å­˜å‚¨ (Google Cloud Storage)
5. åç«¯åœ¨ Shopify Files ä¸­åˆ›å»ºæ–‡ä»¶è®°å½•
6. åç«¯åœ¨ uploaded_file Metaobject ä¸­ä¿å­˜å…ƒæ•°æ®
7. è¿”å›æ–‡ä»¶ä¸‹è½½ URL ç»™å‰ç«¯
```

**æŠ€æœ¯å®ç°**:
- æ–‡ä»¶: `api/upload-file.js`
- ä½¿ç”¨ Shopify GraphQL `stagedUploadsCreate` mutation
- ä½¿ç”¨ Shopify GraphQL `fileCreate` mutation
- æ–‡ä»¶æœ€ç»ˆå­˜å‚¨åœ¨ Shopify CDN

### é˜¶æ®µ 3: æŠ¥ä»·è®°å½•åˆ›å»º ğŸ“

```
æŠ¥ä»·åˆ›å»ºæµç¨‹ï¼š
1. å‰ç«¯æ”¶é›†æ‰€æœ‰ä¿¡æ¯ï¼š
   - æ–‡ä»¶å
   - å®¢æˆ·å§“åå’Œé‚®ç®±
   - åŠ å·¥å‚æ•°
   - æ–‡ä»¶ä¸‹è½½ URL
2. å‘é€ POST è¯·æ±‚åˆ° /api/quotes
3. åç«¯åˆ›å»º quote Metaobject:
   - text: æ–‡ä»¶å
   - author: å®¢æˆ·ä¿¡æ¯ + åŠ å·¥å‚æ•° (åˆå¹¶å­˜å‚¨)
   - status: "Pending" (å¾…å¤„ç†)
   - price: ç©º (å¾…å®¢æœå¡«å†™)
   - invoice_url: æ–‡ä»¶ä¸‹è½½é“¾æ¥
4. è¿”å›åˆ›å»ºæˆåŠŸçš„è®°å½•
```

**æŠ€æœ¯å®ç°**:
- æ–‡ä»¶: `api/quotes-restored.js` (POST æ–¹æ³•)
- ä½¿ç”¨ Shopify GraphQL `metaobjectCreate` mutation
- æ‰€æœ‰æ–°è®°å½•å¼ºåˆ¶è®¾ç½®ä¸º "Pending" çŠ¶æ€

### é˜¶æ®µ 4: å®¢æœå®¡æ ¸å’ŒæŠ¥ä»· ğŸ‘¨â€ğŸ’¼

```
å®¢æœæ“ä½œæµç¨‹ï¼š
1. è®¿é—®ç®¡ç†åå° (/pages/admin-dashboard)
2. æŸ¥çœ‹å¾…å¤„ç†è®¢å•åˆ—è¡¨
3. ç‚¹å‡»"ä¸‹è½½"æŒ‰é’®ä¸‹è½½å®¢æˆ·ä¸Šä¼ çš„æ–‡ä»¶
4. ç‚¹å‡»"é¢„è§ˆ"æŒ‰é’®æŸ¥çœ‹åŠ å·¥å‚æ•°è¯¦æƒ…
5. åˆ†ææ–‡ä»¶å’Œå‚æ•°ï¼Œè®¡ç®—æŠ¥ä»·
6. ç‚¹å‡»"æ·»åŠ æŠ¥ä»·"æŒ‰é’®
7. åœ¨å¼¹çª—ä¸­å¡«å†™ï¼š
   - æŠ¥ä»·é‡‘é¢
   - å¤‡æ³¨è¯´æ˜
   - å‘é€é‚®ç®± (å®¢æœé‚®ç®±)
   - å®¢æˆ·é‚®ç®± (è‡ªåŠ¨æå–)
8. ç‚¹å‡»"æäº¤æŠ¥ä»·"
```

**æŠ€æœ¯å®ç°**:
- æ–‡ä»¶: `templates/page.admin-dashboard.liquid`
- GET è¯·æ±‚åˆ° `/api/quotes` è·å–æ‰€æœ‰è®¢å•
- PATCH è¯·æ±‚åˆ° `/api/quotes?handle=xxx` æ›´æ–°æŠ¥ä»·
- POST è¯·æ±‚åˆ° `/api/send-email` ç”Ÿæˆé‚®ä»¶å†…å®¹

### é˜¶æ®µ 5: é‚®ä»¶å‘é€ ğŸ“§

```
é‚®ä»¶å‘é€æµç¨‹ï¼š
1. å®¢æœæäº¤æŠ¥ä»·åï¼Œç³»ç»Ÿç”Ÿæˆé‚®ä»¶å†…å®¹
2. è°ƒç”¨ /api/send-email ç”Ÿæˆ HTML é‚®ä»¶
3. è¿”å› mailto: é“¾æ¥
4. å¼¹å‡ºå¯¹è¯æ¡†æ˜¾ç¤ºé‚®ä»¶å†…å®¹
5. å®¢æœé€‰æ‹©ï¼š
   a) æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯ (è‡ªåŠ¨å¡«å……æ”¶ä»¶äººã€ä¸»é¢˜ã€æ­£æ–‡)
   b) å¤åˆ¶é‚®ä»¶å†…å®¹ (æ‰‹åŠ¨å‘é€)
6. å®¢æœé€šè¿‡é‚®ä»¶å®¢æˆ·ç«¯å‘é€é‚®ä»¶ç»™å®¢æˆ·
```

**æŠ€æœ¯å®ç°**:
- æ–‡ä»¶: `api/send-email.js`
- ç”Ÿæˆ HTML æ ¼å¼çš„é‚®ä»¶æ­£æ–‡
- è¿”å› `mailto:` URL
- å‰ç«¯ä½¿ç”¨ `window.open()` æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯

---

## æ•°æ®æµå‘å›¾

### å®¢æˆ·ç«¯ â†’ åç«¯ â†’ Shopify

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ä¸Šä¼ æ–‡ä»¶                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ model-uploader.jsâ”‚
                    â”‚  (å‰ç«¯ JS)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                           â”‚
                â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ /api/upload-file â”‚      â”‚   /api/quotes    â”‚
    â”‚  (æ–‡ä»¶ä¸Šä¼  API)  â”‚      â”‚  (æŠ¥ä»·è®°å½• API)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                           â”‚
                â–¼                           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Shopify Files    â”‚      â”‚ quote Metaobject â”‚
    â”‚ (æ–‡ä»¶å­˜å‚¨)       â”‚      â”‚ (æŠ¥ä»·è®°å½•)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                           â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ uploaded_file    â”‚
                    â”‚  Metaobject      â”‚
                    â”‚ (æ–‡ä»¶å…ƒæ•°æ®)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®¢æœå®¡æ ¸å’ŒæŠ¥ä»·

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®¢æœè®¿é—®ç®¡ç†åå°                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ admin-dashboard.liquid   â”‚
                â”‚    (ç®¡ç†ç•Œé¢)            â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚             â”‚             â”‚
                â–¼             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET /quotes â”‚ â”‚PATCH /quotesâ”‚ â”‚POST /send-  â”‚
    â”‚ (è·å–è®¢å•)  â”‚ â”‚ (æ›´æ–°æŠ¥ä»·)  â”‚ â”‚  email      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚             â”‚             â”‚
                â–¼             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Shopify   â”‚ â”‚   Shopify   â”‚ â”‚  ç”Ÿæˆé‚®ä»¶   â”‚
    â”‚ Metaobjects â”‚ â”‚ Metaobjects â”‚ â”‚  å†…å®¹       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  mailto: é“¾æ¥   â”‚
                                  â”‚  æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯ â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## APIè°ƒç”¨æ—¶åº

### 1. å®¢æˆ·ä¸Šä¼ æ–‡ä»¶æ—¶åº

```
å®¢æˆ·æµè§ˆå™¨                model-uploader.js           /api/upload-file              Shopify
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  é€‰æ‹©æ–‡ä»¶                 â”‚                           â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  è¯»å–æ–‡ä»¶ä¸º Base64        â”‚                         â”‚
    â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚                         â”‚
    â”‚                           â”‚          â”‚                â”‚                         â”‚
    â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  POST /api/upload-file    â”‚                         â”‚
    â”‚                           â”‚  { fileData, fileName }   â”‚                         â”‚
    â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  stagedUploadsCreate    â”‚
    â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  è¿”å›ä¸´æ—¶ä¸Šä¼  URL       â”‚
    â”‚                           â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  ä¸Šä¼ æ–‡ä»¶åˆ°ä¸´æ—¶åœ°å€     â”‚
    â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  fileCreate             â”‚
    â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  è¿”å›æ–‡ä»¶ ID å’Œ URL     â”‚
    â”‚                           â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  metaobjectCreate       â”‚
    â”‚                           â”‚                           â”‚  (uploaded_file)        â”‚
    â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  è¿”å›æ–‡ä»¶ URL             â”‚                         â”‚
    â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  POST /api/quotes         â”‚                         â”‚
    â”‚                           â”‚  { text, author, ... }    â”‚                         â”‚
    â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  metaobjectCreate       â”‚
    â”‚                           â”‚                           â”‚  (quote)                â”‚
    â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  è¿”å›æŠ¥ä»·è®°å½•             â”‚                         â”‚
    â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯             â”‚                           â”‚                         â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚                         â”‚
```

### 2. å®¢æœæ·»åŠ æŠ¥ä»·æ—¶åº

```
å®¢æœæµè§ˆå™¨              admin-dashboard.liquid        /api/quotes              Shopify
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  è®¿é—®ç®¡ç†åå°             â”‚                           â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  GET /api/quotes          â”‚                         â”‚
    â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  æŸ¥è¯¢æ‰€æœ‰ quote         â”‚
    â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  è¿”å›è®¢å•åˆ—è¡¨             â”‚                         â”‚
    â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  æ˜¾ç¤ºè®¢å•åˆ—è¡¨             â”‚                           â”‚                         â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  ç‚¹å‡»"æ·»åŠ æŠ¥ä»·"           â”‚                           â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  å¡«å†™æŠ¥ä»·é‡‘é¢å’Œå¤‡æ³¨       â”‚                           â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  ç‚¹å‡»"æäº¤æŠ¥ä»·"           â”‚                           â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  PATCH /api/quotes        â”‚                         â”‚
    â”‚                           â”‚  ?handle=xxx              â”‚                         â”‚
    â”‚                           â”‚  { price, status }        â”‚                         â”‚
    â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚  metaobjectUpdate       â”‚
    â”‚                           â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  è¿”å›æ›´æ–°åçš„è®°å½•         â”‚                         â”‚
    â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  POST /api/send-email     â”‚                         â”‚
    â”‚                           â”‚  { email, amount, ... }   â”‚                         â”‚
    â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚                           â”‚  è¿”å› mailto: URL         â”‚                         â”‚
    â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  æ˜¾ç¤ºé‚®ä»¶å¯¹è¯æ¡†           â”‚                           â”‚                         â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚                         â”‚
    â”‚                           â”‚                           â”‚                         â”‚
    â”‚  æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯           â”‚                           â”‚                         â”‚
    â”‚  (window.open mailto:)    â”‚                           â”‚                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚                         â”‚
```

---

## æ•°æ®ç»“æ„è¯´æ˜

### 1. Quote Metaobject (æŠ¥ä»·è®°å½•)

Shopify Metaobject ç±»å‹: `quote`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `text` | String | æ–‡ä»¶å | `"model.STEP"` |
| `author` | String | å®¢æˆ·ä¿¡æ¯ + åŠ å·¥å‚æ•° | `"å¼ ä¸‰ (zhang@example.com) \| æ•°é‡:10ä»¶ \| ææ–™:ABS \| ç²¾åº¦:é«˜ç²¾åº¦ \| ..."` |
| `status` | String | è®¢å•çŠ¶æ€ | `"Pending"` / `"Quoted"` / `"Completed"` |
| `price` | String | æŠ¥ä»·é‡‘é¢ | `"1500.00"` |
| `invoice_url` | String | æ–‡ä»¶ä¸‹è½½é“¾æ¥ | `"https://shopify-13s4.vercel.app/api/download-file?id=file_xxx"` |

**ä¸ºä»€ä¹ˆå‚æ•°å­˜å‚¨åœ¨ author å­—æ®µï¼Ÿ**
- Shopify Metaobject åªæ”¯æŒé¢„å®šä¹‰çš„å­—æ®µ
- æ— æ³•åŠ¨æ€æ·»åŠ æ–°å­—æ®µ
- å› æ­¤å°†æ‰€æœ‰å‚æ•°åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå­˜å‚¨åœ¨ `author` å­—æ®µä¸­
- æ ¼å¼: `å®¢æˆ·å (é‚®ç®±) | å‚æ•°1:å€¼1 | å‚æ•°2:å€¼2 | ...`

### 2. Uploaded_file Metaobject (æ–‡ä»¶å…ƒæ•°æ®)

Shopify Metaobject ç±»å‹: `uploaded_file`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|
| `file_id` | String | å”¯ä¸€æ–‡ä»¶ID | `"file_1759114189482_jt19vrzqj"` |
| `file_name` | String | åŸå§‹æ–‡ä»¶å | `"model.STEP"` |
| `file_type` | String | MIME ç±»å‹ | `"application/step"` |
| `file_data` | String | æ–‡ä»¶å†…å®¹ (å·²åºŸå¼ƒ) | `""` (ç°åœ¨ä¸ºç©º) |
| `file_url` | String | Shopify CDN URL | `"https://cdn.shopify.com/s/files/..."` |
| `shopify_file_id` | String | Shopify Files ID | `"gid://shopify/GenericFile/123456"` |
| `order_id` | String | å…³è”çš„è®¢å•ID | `"quote-abc123"` |
| `upload_time` | String | ä¸Šä¼ æ—¶é—´ | `"2025-01-29T10:30:00.000Z"` |
| `file_size` | String | æ–‡ä»¶å¤§å°(å­—èŠ‚) | `"683520"` |

### 3. API è¯·æ±‚/å“åº”æ ¼å¼

#### POST /api/upload-file

**è¯·æ±‚ä½“**:
```json
{
  "fileData": "data:application/step;base64,U1RFUCBGSUxF...",
  "fileName": "model.STEP",
  "fileType": "application/step",
  "orderId": "quote-abc123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "fileId": "file_1759114189482_jt19vrzqj",
  "fileName": "model.STEP",
  "fileUrl": "https://shopify-13s4.vercel.app/api/download-file?id=file_1759114189482_jt19vrzqj",
  "shopifyFileId": "gid://shopify/GenericFile/123456",
  "cdnUrl": "https://cdn.shopify.com/s/files/...",
  "fileSize": 683520,
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼ˆShopify Files å®Œæ•´å­˜å‚¨ï¼‰"
}
```

#### POST /api/quotes

**è¯·æ±‚ä½“**:
```json
{
  "text": "model.STEP",
  "author": "å¼ ä¸‰",
  "email": "zhang@example.com",
  "status": "Pending",
  "price": "",
  "invoice_url": "https://shopify-13s4.vercel.app/api/download-file?id=file_xxx"
}
```

**å“åº”**:
```json
{
  "id": "gid://shopify/Metaobject/169287057695",
  "handle": "zhang-example-com",
  "fields": [
    { "key": "text", "value": "model.STEP" },
    { "key": "author", "value": "å¼ ä¸‰ (zhang@example.com) | æ•°é‡:10ä»¶ | ææ–™:ABS | ..." },
    { "key": "status", "value": "Pending" },
    { "key": "price", "value": "" },
    { "key": "invoice_url", "value": "https://shopify-13s4.vercel.app/api/download-file?id=file_xxx" }
  ]
}
```

#### PATCH /api/quotes?handle=zhang-example-com

**è¯·æ±‚ä½“**:
```json
{
  "price": "1500.00",
  "status": "Quoted"
}
```

**å“åº”**: åŒ POST å“åº”æ ¼å¼

#### POST /api/send-email

**è¯·æ±‚ä½“**:
```json
{
  "customerEmail": "zhang@example.com",
  "senderEmail": "service@company.com",
  "amount": "1500.00",
  "fileName": "model.STEP",
  "notes": "é¢„è®¡äº¤ä»˜æ—¶é—´ï¼š3-5ä¸ªå·¥ä½œæ—¥"
}
```

**å“åº”**:
```json
{
  "success": true,
  "mailto": "mailto:zhang@example.com?subject=...",
  "email": {
    "to": "zhang@example.com",
    "from": "service@company.com",
    "subject": "æ‚¨çš„3Dæ¨¡å‹å®šåˆ¶æŠ¥ä»·",
    "body": "å°Šæ•¬çš„å®¢æˆ·...",
    "html": "<html>...</html>"
  }
}
```

---

## å…³é”®æŠ€æœ¯ç‚¹

### 1. Base64 ç¼–ç 

**ä¸ºä»€ä¹ˆä½¿ç”¨ Base64ï¼Ÿ**
- æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œæ— æ³•ç›´æ¥åœ¨ JSON ä¸­ä¼ è¾“
- Base64 å°†äºŒè¿›åˆ¶è½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼
- å¯ä»¥å®‰å…¨åœ°é€šè¿‡ HTTP ä¼ è¾“

**ç¤ºä¾‹**:
```javascript
// è¯»å–æ–‡ä»¶
const file = event.target.files[0];
const reader = new FileReader();
reader.onload = function(e) {
  const base64Data = e.target.result; // "data:application/step;base64,U1RFUCBGSUxF..."
  // å‘é€åˆ°åç«¯
};
reader.readAsDataURL(file);
```

### 2. Shopify Staged Upload

**ä¸ºä»€ä¹ˆéœ€è¦ Staged Uploadï¼Ÿ**
- ç›´æ¥ä¸Šä¼ å¤§æ–‡ä»¶åˆ° Shopify API ä¼šè¶…æ—¶
- Staged Upload åˆ†ä¸¤æ­¥ï¼šå…ˆè·å–ä¸´æ—¶åœ°å€ï¼Œå†ä¸Šä¼ æ–‡ä»¶
- æ–‡ä»¶ä¸Šä¼ åˆ° Google Cloud Storageï¼Œé€Ÿåº¦æ›´å¿«

**æµç¨‹**:
1. è°ƒç”¨ `stagedUploadsCreate` è·å–ä¸´æ—¶ URL
2. ä½¿ç”¨ HTTP POST ä¸Šä¼ æ–‡ä»¶åˆ°ä¸´æ—¶ URL
3. è°ƒç”¨ `fileCreate` åˆ›å»ºæ°¸ä¹…è®°å½•
4. Shopify è‡ªåŠ¨å°†æ–‡ä»¶ä»ä¸´æ—¶åœ°å€ç§»åˆ°æ°¸ä¹…å­˜å‚¨

### 3. CORS (è·¨åŸŸèµ„æºå…±äº«)

**ä¸ºä»€ä¹ˆéœ€è¦ CORSï¼Ÿ**
- å‰ç«¯åŸŸå: `sain-pdc-test.myshopify.com`
- åç«¯åŸŸå: `shopify-13s4.vercel.app`
- æµè§ˆå™¨å®‰å…¨ç­–ç•¥é˜»æ­¢è·¨åŸŸè¯·æ±‚
- å¿…é¡»åœ¨åç«¯è®¾ç½® CORS å¤´å…è®¸è·¨åŸŸ

**è®¾ç½®**:
```javascript
res.setHeader('Access-Control-Allow-Origin', 'https://sain-pdc-test.myshopify.com');
res.setHeader('Access-Control-Allow-Methods', 'GET,POST,PATCH,DELETE,OPTIONS');
res.setHeader('Access-Control-Allow-Headers', 'Content-Type');
```

### 4. GraphQL vs REST

**ä¸ºä»€ä¹ˆä½¿ç”¨ GraphQLï¼Ÿ**
- Shopify Admin API ä¸»è¦ä½¿ç”¨ GraphQL
- å¯ä»¥ç²¾ç¡®æŒ‡å®šéœ€è¦çš„å­—æ®µï¼Œå‡å°‘æ•°æ®ä¼ è¾“
- ä¸€æ¬¡è¯·æ±‚å¯ä»¥æ“ä½œå¤šä¸ªèµ„æº
- ç±»å‹å®‰å…¨ï¼Œæœ‰å®Œæ•´çš„ schema æ–‡æ¡£

**ç¤ºä¾‹**:
```graphql
mutation {
  metaobjectCreate(metaobject: {
    type: "quote",
    fields: [
      { key: "text", value: "model.STEP" },
      { key: "author", value: "å¼ ä¸‰" }
    ]
  }) {
    metaobject {
      id
      handle
    }
    userErrors {
      field
      message
    }
  }
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆæ–‡ä»¶ä¸‹è½½é“¾æ¥æ˜¯ Vercel åŸŸåè€Œä¸æ˜¯ Shopifyï¼Ÿ

**A**: è¿™æ˜¯ä¸€ä¸ªä»£ç†è®¾è®¡ï¼š
- æ–‡ä»¶å®é™…å­˜å‚¨åœ¨ Shopify CDN
- ä½†é€šè¿‡ Vercel API (`/api/download-file`) ä»£ç†ä¸‹è½½
- å¥½å¤„ï¼šå¯ä»¥æ·»åŠ æƒé™éªŒè¯ã€æ—¥å¿—è®°å½•ç­‰ä¸­é—´å±‚é€»è¾‘
- æœªæ¥å¯ä»¥æ‰©å±•ä¸ºéœ€è¦ç™»å½•æ‰èƒ½ä¸‹è½½

### Q2: ä¸ºä»€ä¹ˆé‚®ä»¶ä¸æ˜¯è‡ªåŠ¨å‘é€ï¼Œè€Œæ˜¯æ‰“å¼€é‚®ä»¶å®¢æˆ·ç«¯ï¼Ÿ

**A**: æŠ€æœ¯å’Œå®‰å…¨é™åˆ¶ï¼š
- Vercel Serverless Functions ä¸æ”¯æŒ SMTP å‘é€é‚®ä»¶
- ä½¿ç”¨ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡ï¼ˆå¦‚ SendGridï¼‰éœ€è¦é¢å¤–é…ç½®å’Œè´¹ç”¨
- `mailto:` æ–¹æ¡ˆç®€å•å¯é ï¼Œæ— éœ€é¢å¤–æœåŠ¡
- å®¢æœå¯ä»¥åœ¨å‘é€å‰æ£€æŸ¥å’Œä¿®æ”¹é‚®ä»¶å†…å®¹

### Q3: ä¸ºä»€ä¹ˆæ‰€æœ‰å‚æ•°éƒ½å­˜å‚¨åœ¨ author å­—æ®µï¼Ÿ

**A**: Shopify Metaobject é™åˆ¶ï¼š
- Metaobject åªæ”¯æŒé¢„å®šä¹‰çš„å­—æ®µ
- åˆ›å»ºåæ— æ³•åŠ¨æ€æ·»åŠ æ–°å­—æ®µ
- å¦‚æœä¸ºæ¯ä¸ªå‚æ•°åˆ›å»ºå­—æ®µï¼Œä¼šå¯¼è‡´å­—æ®µè¿‡å¤š
- åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²æ˜¯æœ€çµæ´»çš„æ–¹æ¡ˆ

### Q4: å¦‚ä½•å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ ï¼Ÿ

**A**: ä½¿ç”¨ Shopify Staged Uploadï¼š
- æ”¯æŒæœ€å¤§ 100MB æ–‡ä»¶
- åˆ†æ­¥ä¸Šä¼ ï¼Œé¿å…è¶…æ—¶
- æ–‡ä»¶å­˜å‚¨åœ¨ Google Cloud Storage
- è‡ªåŠ¨æä¾› CDN åŠ é€Ÿ

---

## ä¸‹ä¸€æ­¥å­¦ä¹ 

1. **é˜…è¯»ä»£ç æ³¨é‡Š**: æ¯ä¸ªæ ¸å¿ƒæ–‡ä»¶éƒ½æœ‰è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
2. **æŸ¥çœ‹åˆå­¦è€…æŒ‡å—**: `BEGINNER_GUIDE.md` æœ‰æ›´å¤šæ¦‚å¿µè§£é‡Š
3. **å®è·µæ“ä½œ**: åœ¨æµ‹è¯•ç¯å¢ƒä¸­å°è¯•å®Œæ•´æµç¨‹
4. **è°ƒè¯•æŠ€å·§**: ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
5. **Shopify æ–‡æ¡£**: æ·±å…¥å­¦ä¹  Shopify GraphQL API

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-01-29  
**ç»´æŠ¤è€…**: AI Assistant

